<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" type="image/x-icon" href="favicon.ico">
<title>Cosmic Games</title>
<style>
  :root{
    --bg-deep:#070814;
    --bg-card:#0e1030;
    --bg-panel:#0b0d24;
    --ink:#dfe7ff;
    --ink-dim:#a7b0d9;
    --accent:#7aa2ff;
    --accent-2:#8ef5ff;
    --win:#43f57a;
    --lose:#ff6b6b;
    --warn:#ffd166;
    --table:#0a2a2a; /* blackjack felt */
    --chip:#2dd4bf;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg-deep);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,"Helvetica Neue",Arial,sans-serif}
  a{color:var(--accent)}
  button{background:#1a1e4d;color:var(--ink);border:1px solid #2a3180;border-radius:10px;padding:.7rem 1rem;font-weight:600;cursor:pointer;transition:.15s}
  button:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(122,162,255,.12)}
  button:disabled{opacity:.6;cursor:not-allowed}
  .ghost{background:transparent;border:1px solid #2a3180}
  .accent{background:linear-gradient(180deg,#3242a8,#1e2a8a);border-color:#4656cc}
  input,select{background:#0c1033;border:1px solid #2a3180;color:var(--ink);padding:.6rem .8rem;border-radius:10px}
  /* Layout */
  .app{position:relative;min-height:100%;overflow:hidden}
  /* Animated starfield canvas backdrop */
  #starfield,#nebula{
    position:fixed;inset:0;z-index:0;display:block;pointer-events:none
  }
  #nebula{filter:blur(40px);opacity:.55;mix-blend-mode:screen}
  /* Top bar */
  .topbar{
    position:relative;z-index:2;display:flex;gap:1rem;align-items:center;justify-content:space-between;padding:14px 20px;background:linear-gradient(180deg,rgba(10,12,32,.85),rgba(10,12,32,.55));
    border-bottom:1px solid rgba(255,255,255,.06);backdrop-filter:saturate(140%) blur(8px)
  }
  .brand{display:flex;gap:.7rem;align-items:center;font-weight:800;letter-spacing:.8px}
  .brand .logo{width:28px;height:28px;border-radius:8px;display:grid;place-items:center;background:radial-gradient(circle at 30% 30%,#8ef5ff,transparent 45%),radial-gradient(circle at 70% 70%,#7aa2ff,transparent 45%),#141a44;box-shadow:0 0 20px #7aa2ff50 inset,0 0 0 1px #334}
  .pill{display:inline-flex;gap:.5rem;align-items:center;padding:.4rem .7rem;border:1px solid #2a3180;border-radius:999px;background:#0c1033}
  /* Main grid */
  .grid{position:relative;z-index:1;display:grid;grid-template-columns:320px 1fr;gap:18px;max-width:1300px;margin:18px auto;padding:0 18px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  .panel{background:linear-gradient(180deg,rgba(12,16,51,.95),rgba(7,8,20,.96));border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:16px;box-shadow:0 10px 40px rgba(10,12,30,.35)}
  /* Sidebar */
  .sidebar h3{margin:8px 0 12px;font-size:14px;color:var(--ink-dim);text-transform:uppercase;letter-spacing:1.2px}
  .game-list{display:grid;gap:10px}
  .game-item{display:flex;align-items:center;gap:12px;padding:10px;border-radius:12px;cursor:pointer;border:1px solid rgba(255,255,255,.06);background:#0b0e2b}
  .game-item:hover{background:#0f133a}
  .game-item .icon{font-size:20px}
  .active{outline:2px solid #3751ff}
  /* Stage */
  .stage{min-height:540px;display:grid;grid-template-rows:auto 1fr}
  .stage-header{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
  .stage-viewport{position:relative;border-radius:14px;border:1px solid rgba(255,255,255,.06);background:radial-gradient(1200px 600px at 40% 30%,#0c133f 0%,#070814 60%)}
  .stage-inner{padding:16px}
  .flex{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .wrap{flex-wrap:wrap}
  .spacer{flex:1}
  .muted{color:var(--ink-dim)}
  .badge{padding:.2rem .5rem;background:#1a1e4d;border:1px solid #2a3180;border-radius:999px;font-size:.8rem}
  /* Reusable canvases */
  canvas.game-canvas{display:block;width:100%;max-width:900px;height:540px;background:#090b1f;border-radius:12px;margin:auto}
  /* Simple tables */
  table{width:100%;border-collapse:collapse}
  td,th{padding:8px;border-bottom:1px solid rgba(255,255,255,.06);text-align:left}
  /* Blackjack visuals */
  .bj-wrap{display:grid;gap:12px;padding:12px}
  .bj-table{
    position:relative;border-radius:16px;border:1px solid rgba(255,255,255,.08);
    background:
      radial-gradient(1200px 600px at 20% 10%, rgba(122,162,255,.15), transparent 60%),
      radial-gradient(1200px 600px at 80% 90%, rgba(142,245,255,.12), transparent 60%),
      radial-gradient(600px 300px at 50% 0%, rgba(255,255,255,.05), transparent 60%),
      var(--table);
    padding:18px;min-height:420px;display:grid;grid-template-rows:auto 1fr auto;gap:10px
  }
  .chip{display:inline-grid;place-items:center;width:38px;height:38px;border-radius:999px;font-weight:800;border:3px solid white;background:var(--chip);box-shadow:0 4px 0 rgba(0,0,0,.25) inset,0 0 0 2px #0b102a}
  .rack{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .hand{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .card{
    width:74px;height:104px;border-radius:10px;background:#f4f7ff;border:1px solid #ccd5ff;box-shadow:0 6px 18px rgba(0,0,0,.25);
    display:grid;grid-template-rows:auto 1fr auto;overflow:hidden;position:relative
  }
  .card .rank{font-weight:900;font-size:18px;padding:6px 8px}
  .card .suit{font-size:20px;padding:0 8px}
  .card .pips{display:grid;place-items:center;font-size:28px;color:#111;margin-bottom:6px}
  .card.black{color:#111}
  .card.red{color:#b10c2b}
  .card.back{
    background:
      repeating-linear-gradient(45deg, #102255 0 8px, #0c1a44 8px 16px),
      radial-gradient(600px 600px at 10% 10%, rgba(255,255,255,.08), transparent 60%);
    border-color:#20337a
  }
  .banner{display:flex;align-items:center;justify-content:center;gap:.6rem;padding:.4rem .8rem;border-radius:999px;background:#0e153f;border:1px solid #2a3180}
  .banner.win{color:var(--win);border-color:#2f6f4f;background:#0b2e1a}
  .banner.lose{color:var(--lose);border-color:#6f2f2f;background:#2e0b0b}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  /* Help modal */
  .modal-back{position:fixed;inset:0;background:rgba(5,7,20,.6);backdrop-filter:blur(6px);display:none;align-items:center;justify-content:center;z-index:10}
  .modal{width:min(720px,92vw);background:linear-gradient(180deg,#0b0e2b,#090b1f);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px}
  .modal h2{margin:.2rem 0 .6rem}
  .modal-back.show{display:flex}
  /* Footer */
  .foot{opacity:.8;text-align:center;padding:10px}
  /* Tiny HUD tags */
  .kv{display:inline-flex;gap:.4rem;align-items:center;padding:.35rem .6rem;border-radius:10px;background:#10133a;border:1px solid rgba(255,255,255,.08);font-size:.9rem}
</style>
</head>
<body>
<div class="app">
  <canvas id="nebula"></canvas>
  <canvas id="starfield"></canvas>

  <div class="topbar">
    <div class="brand">
      <div class="logo">‚òÖ</div>
      <div>Stellar Arcade</div>
    </div>
    <div class="flex wrap">
      <div class="pill">
        <span>üë§</span>
        <input id="username" placeholder="Enter username" style="width:180px" />
        <button id="saveUser" class="ghost">Save</button>
      </div>
      <div class="pill"><span>üí∞</span> <span>Balance:</span> <strong id="bal">$0</strong></div>
      <button id="openHelp" class="accent">Help</button>
    </div>
  </div>

  <div class="grid">
    <!-- Sidebar -->
    <aside class="panel sidebar">
      <h3>Games</h3>
      <div class="game-list" id="gameList">
        <div class="game-item active" data-game="landing"><div class="icon">üèÅ</div><div>Landing</div></div>
        <div class="game-item" data-game="shooter"><div class="icon">üöÄ</div><div>Astro Shooter</div></div>
        <div class="game-item" data-game="blackjack"><div class="icon">üÉè</div><div>Blackjack</div></div>
        <div class="game-item" data-game="tictactoe"><div class="icon">‚ùå‚≠ï</div><div>Cosmic Tic‚ÄëTac‚ÄëToe</div></div>
        <div class="game-item" data-game="snake"><div class="icon">ü™±</div><div>Orbital Snake</div></div>
        <div class="game-item" data-game="memory"><div class="icon">üß†</div><div>Meteor Match</div></div>
      </div>
      <h3>Stats</h3>
      <div class="panel" style="padding:12px;background:#0a0d2a">
        <div class="flex"><span class="kv">üëæ Shooter high: <b id="hiShooter">0</b></span></div>
        <div class="flex"><span class="kv">üÉè BJ bankroll best: <b id="hiBankroll">$0</b></span></div>
        <div class="flex"><span class="kv">ü™± Snake length best: <b id="hiSnake">0</b></span></div>
        <div class="flex"><span class="kv">‚≠ï Tic‚ÄëTac‚ÄëToe wins: <b id="tttWins">0</b></span></div>
        <div class="flex"><span class="kv">üß† Fastest match: <b id="memBest">‚Äî</b></span></div>
      </div>
    </aside>

    <!-- Stage -->
    <main class="panel stage">
      <div class="stage-header">
        <div class="flex">
          <div class="badge">üåå Space Edition</div>
          <div class="muted">Animated starfield ‚Ä¢ Drifting nebula ‚Ä¢ Saved progress</div>
        </div>
        <div class="flex">
          <button id="btnSound" class="ghost">üîä Sound On</button>
        </div>
      </div>
      <div class="stage-viewport" id="stage">
        <!-- Landing -->
        <section class="stage-inner" id="landing">
          <h1 style="margin:6px 0 4px">Welcome to <span style="color:var(--accent)">Stellar Arcade</span> ‚ú®</h1>
          <p class="muted">Choose a game on the left. Your username, balance, and highscores are saved locally.</p>
          <div class="panel" style="margin-top:12px">
            <h3>Quick Start</h3>
            <ol>
              <li>Set your username (top right) ‚Äî you‚Äôll start with $1,000 credits.</li>
              <li>Click a game in the sidebar.</li>
              <li>For <b>Astro Shooter</b>: use <b>‚Üê ‚Üí</b> to move, <b>Space</b> to fire, survive waves to reach the planet.</li>
              <li>For <b>Blackjack</b>: place a bet with chips, then Hit/Stand. Standard 52‚Äëcard shoe, reshuffles as needed.</li>
            </ol>
          </div>
        </section>

        <!-- Astro Shooter -->
        <section class="stage-inner" id="shooter" style="display:none">
          <div class="flex" style="margin-bottom:8px">
            <div class="badge">üéÆ Controls: ‚Üê ‚Üí move ‚Ä¢ Space shoot ‚Ä¢ P pause</div>
            <div class="spacer"></div>
            <button id="shooterStart" class="accent">Start / Restart</button>
            <span class="kv">Level: <b id="lvl">1</b></span>
            <span class="kv">Score: <b id="score">0</b></span>
            <span class="kv">Lives: <b id="lives">3</b></span>
          </div>
          <canvas id="shooterCanvas" class="game-canvas" width="900" height="540"></canvas>
        </section>

        <!-- Blackjack -->
        <section class="stage-inner" id="blackjack" style="display:none">
          <div class="bj-wrap">
            <div class="banner" id="bjMsg">Place your bet to begin.</div>
            <div class="bj-table">
              <div class="flex" style="justify-content:space-between">
                <div class="kv">Dealer</div>
                <div class="kv">Deck: <span id="bjDeckLeft">52</span></div>
              </div>
              <div class="hand" id="dealerHand" style="justify-content:center;margin-top:8px;"></div>
              <div class="flex" style="justify-content:space-between;margin-top:6px">
                <div class="kv">Player: <b id="bjUser">‚Äî</b></div>
                <div class="kv">Balance: <b id="bjBal">$0</b></div>
              </div>
              <div class="hand" id="playerHand" style="justify-content:center;margin-top:6px;"></div>
              <div class="controls" style="justify-content:center;margin-top:8px">
                <button id="btnDeal" class="accent">Deal</button>
                <button id="btnHit">Hit</button>
                <button id="btnStand">Stand</button>
                <button id="btnDouble">Double</button>
                <button id="btnNewRound" class="ghost">New Round</button>
              </div>
              <div class="flex" style="justify-content:center;margin-top:8px">
                <div class="rack">
                  <button class="chip" data-bet="10">$10</button>
                  <button class="chip" data-bet="25">$25</button>
                  <button class="chip" data-bet="50">$50</button>
                  <button class="chip" data-bet="100">$100</button>
                  <span class="kv">Bet: <b id="bjBet">$0</b></span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- TicTacToe -->
        <section class="stage-inner" id="tictactoe" style="display:none">
          <div class="flex" style="margin-bottom:8px">
            <div class="badge">Play vs. CPU</div>
            <button id="tttReset" class="ghost">Reset</button>
            <div class="spacer"></div>
            <span class="kv">Wins: <b id="tttWinsLbl">0</b></span>
          </div>
          <div id="tttBoard" style="display:grid;grid-template-columns:repeat(3,120px);gap:12px;justify-content:center;margin:12px auto">
            <!-- Cells injected -->
          </div>
          <div id="tttStatus" class="banner" style="justify-content:center;margin:0 auto;max-width:360px">Make a move.</div>
        </section>

        <!-- Snake -->
        <section class="stage-inner" id="snake" style="display:none">
          <div class="flex" style="margin-bottom:8px">
            <div class="badge">Controls: Arrow Keys</div>
            <div class="spacer"></div>
            <button id="snakeStart" class="accent">Start</button>
            <span class="kv">Score: <b id="snakeScore">0</b></span>
            <span class="kv">Best: <b id="snakeBest">0</b></span>
          </div>
          <canvas id="snakeCanvas" class="game-canvas" width="900" height="540"></canvas>
        </section>

        <!-- Memory -->
        <section class="stage-inner" id="memory" style="display:none">
          <div class="flex" style="margin-bottom:8px">
            <div class="badge">Flip pairs. Fewer moves = better time.</div>
            <div class="spacer"></div>
            <button id="memRestart" class="accent">Restart</button>
            <span class="kv">Moves: <b id="memMoves">0</b></span>
            <span class="kv">Time: <b id="memTime">0.0s</b></span>
          </div>
          <div id="memGrid" style="display:grid;grid-template-columns:repeat(6,100px);gap:12px;justify-content:center;margin:0 auto 12px"></div>
          <div id="memBanner" class="banner" style="justify-content:center;max-width:420px;margin:0 auto">Good luck!</div>
        </section>

      </div>
      <div class="foot muted">¬© <span id="year"></span> Stellar Arcade</div>
    </main>
  </div>

  <!-- Help Modal -->
  <div class="modal-back" id="helpBack">
    <div class="modal">
      <div class="flex" style="justify-content:space-between">
        <h2>How to Play</h2>
        <button id="closeHelp" class="ghost">‚úñ</button>
      </div>
      <ul>
        <li><b>Astro Shooter:</b> Use ‚Üê ‚Üí to move the ship and Space to fire. Clear meteors to advance levels. Each level adds speed, meteor count, and occasional fast ‚Äúcomet‚Äù rocks.</li>
        <li><b>Blackjack:</b> Click chips to set a bet, then <i>Deal</i>. Hit/Stand/Double. 3:2 Blackjack, dealer stands on soft 17, reshuffles when the shoe gets low.</li>
        <li><b>Snake:</b> Eat glowing orbs, don‚Äôt hit yourself. Faster over time.</li>
        <li><b>Tic‚ÄëTac‚ÄëToe:</b> You‚Äôre ‚ùå, CPU is ‚≠ï. Win to increment your stat.</li>
        <li><b>Memory:</b> Match pairs of meteor/planet tiles. Timer and move counter track your best.</li>
      </ul>
      <p class="muted">Your username, balance, and highscores are stored in your browser with localStorage.</p>
    </div>
  </div>
</div>

<script>
/* -------------------------
   Persistent profile & bank
--------------------------*/
const store = {
  get k(){ return 'stellar.arcade.v1'},
  load(){
    try{ return JSON.parse(localStorage.getItem(this.k))||{} }catch{ return {} }
  },
  save(data){
    localStorage.setItem(this.k, JSON.stringify(data))
  }
}
const state = Object.assign({
  user:'', bank:1000,
  hi:{ shooter:0, bankroll:1000, snake:0, tttWins:0, memBest:null }
}, store.load());

const $ = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);

const username = $('#username');
const saveUser = $('#saveUser');
const bal = $('#bal');
const bjUser = $('#bjUser');
const bjBal = $('#bjBal');
const hiShooter = $('#hiShooter');
const hiBankroll = $('#hiBankroll');
const hiSnake = $('#hiSnake');
const tttWins = $('#tttWins');
const tttWinsLbl = $('#tttWinsLbl');
const memBest = $('#memBest');

function renderProfile(){
  username.value = state.user || '';
  bal.textContent = `$${state.bank.toLocaleString()}`;
  bjUser.textContent = state.user || 'Player';
  bjBal.textContent = `$${state.bank.toLocaleString()}`;
  hiShooter.textContent = state.hi.shooter;
  hiBankroll.textContent = `$${(state.hi.bankroll||0).toLocaleString()}`;
  hiSnake.textContent = state.hi.snake;
  tttWins.textContent = state.hi.tttWins;
  tttWinsLbl.textContent = state.hi.tttWins;
  memBest.textContent = state.hi.memBest ? state.hi.memBest + 's' : '‚Äî';
}
saveUser.addEventListener('click', ()=>{
  state.user = username.value.trim() || 'Player';
  if(state.bank==null || Number.isNaN(state.bank)) state.bank = 1000;
  state.hi.bankroll = Math.max(state.hi.bankroll||0, state.bank);
  store.save(state); renderProfile();
});
renderProfile();
$('#year').textContent = new Date().getFullYear();

/* -------------------------
   Router (sidebar switching)
--------------------------*/
const gameList = $('#gameList');
const sections = ['landing','shooter','blackjack','tictactoe','snake','memory'].map(id=>$('#'+id));
gameList.addEventListener('click', (e)=>{
  const item = e.target.closest('.game-item'); if(!item) return;
  const game = item.dataset.game;
  $$('.game-item').forEach(n=>n.classList.remove('active'));
  item.classList.add('active');
  sections.forEach(s=>s.style.display = s.id===game?'block':'none');
});

/* -------------------------
   Background: starfield + nebula
--------------------------*/
(function(){
  const neb = document.getElementById('nebula');
  const nctx = neb.getContext('2d');
  const star = document.getElementById('starfield');
  const sctx = star.getContext('2d');
  let W,H; let stars=[], layers=[0.2,0.6,1.2]; // parallax
  function resize(){
    W = star.width = neb.width = window.innerWidth;
    H = star.height = neb.height = window.innerHeight;
    // rebuild stars on resize for density
    const count = Math.min(700, Math.floor(W*H/2500));
    stars = [...Array(count)].map(()=>({
      x: Math.random()*W,
      y: Math.random()*H,
      z: layers[Math.floor(Math.random()*layers.length)],
      r: Math.random()*1.6+0.2,
      tw: Math.random()*Math.PI*2
    }));
  }
  window.addEventListener('resize', resize); resize();

  let t=0;
  function drawNebula(){
    nctx.clearRect(0,0,W,H);
    const grad = nctx.createRadialGradient(
      W*0.3 + Math.sin(t*.0002)*120, H*0.25 + Math.cos(t*.00015)*80, 50,
      W*0.5, H*0.6, Math.max(W,H)*0.9
    );
    grad.addColorStop(0,'rgba(122,162,255,.25)');
    grad.addColorStop(.3,'rgba(142,245,255,.22)');
    grad.addColorStop(.7,'rgba(80,100,210,.15)');
    grad.addColorStop(1,'rgba(0,0,0,0)');
    nctx.fillStyle = grad;
    nctx.fillRect(0,0,W,H);
  }
  function drawStars(){
    sctx.clearRect(0,0,W,H);
    for(const st of stars){
      st.x -= st.z * 0.15; // drift left
      if(st.x< -5){ st.x=W+5; st.y=Math.random()*H }
      st.tw += 0.05*st.z;
      const alpha = 0.6 + Math.sin(st.tw)*0.4;
      sctx.fillStyle = `rgba(220,235,255,${alpha})`;
      sctx.beginPath();
      sctx.arc(st.x, st.y, st.r*st.z, 0, Math.PI*2);
      sctx.fill();
    }
  }
  function loop(ms){
    t = ms;
    drawNebula();
    drawStars();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
})();

/* -------------------------
   Astro Shooter (8-bit look)
--------------------------*/
(function(){
  const c = document.getElementById('shooterCanvas');
  const ctx = c.getContext('2d');
  const startBtn = document.getElementById('shooterStart');
  const lvlLbl = document.getElementById('lvl');
  const scoreLbl = document.getElementById('score');
  const livesLbl = document.getElementById('lives');
  let running=false, paused=false;

  const W=c.width, H=c.height;
  function pxRect(x,y,w,h,color){ // chunky 8-bit blocks
    ctx.imageSmoothingEnabled=false;
    ctx.fillStyle=color; ctx.fillRect(Math.floor(x),Math.floor(y),Math.floor(w),Math.floor(h));
  }
  const keys={};
  window.addEventListener('keydown',e=>{
    if(sections.find(s=>s.id==='shooter').style.display!=='block') return;
    keys[e.key]=true; if(e.key==='p'||e.key==='P'){paused=!paused}
  });
  window.addEventListener('keyup',e=>{keys[e.key]=false});

  let player, bullets, rocks, score, lives, level, nextRock, planetX, planetY, planetR, planetIn=false;
  function resetGame(){
    player={x:W/2-12,y:H-70,w:24,h:24,speed:5,cd:0};
    bullets=[];
    rocks=[];
    score=0; lives=3; level=1; nextRock=0; planetIn=false; planetX=W/2; planetY=-120; planetR=50;
    lvlLbl.textContent=level; scoreLbl.textContent=score; livesLbl.textContent=lives;
  }
  function spawnWave(){
    const count = 6 + level*2;
    for(let i=0;i<count;i++){
      rocks.push({
        x: Math.random()*W, y: -Math.random()*400-20,
        r: 10 + Math.random()*16 + level*0.6,
        vy: 1.2 + level*0.25 + Math.random()*0.6,
        vx: (Math.random()-.5)*(0.5+level*0.1),
        hp: 1 + Math.floor(level/2),
        comet: Math.random()<Math.min(0.05*level, .25)
      });
    }
  }
  function drawShip(){
    // retro rocket built from blocks
    const {x,y,w,h}=player;
    pxRect(x,y,w,h,'#a6b4ff'); // body
    pxRect(x+6,y-8,12,8,'#cfe4ff'); // cockpit
    pxRect(x+4,y+h,16,6,'#ffdf6e'); // flame
    pxRect(x+4,y+h+6,16,4,'#ffa44d');
  }
  function drawPlanet(){
    if(!planetIn) return;
    // glowing planet at top
    const g=ctx.createRadialGradient(planetX,planetY,10,planetX,planetY,planetR*1.6);
    g.addColorStop(0,'#8ef5ff');
    g.addColorStop(1,'rgba(142,245,255,0)');
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(planetX,planetY,planetR*1.6,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#7aa2ff'; ctx.beginPath(); ctx.arc(planetX,planetY,planetR,0,Math.PI*2); ctx.fill();
  }
  function step(){
    if(!running){return}
    if(paused){ requestAnimationFrame(step); return; }
    ctx.clearRect(0,0,W,H);

    // Planet entrance after wave cleared
    if(rocks.length===0 && !planetIn){
      planetIn=true;
    }
    if(planetIn){
      planetY += 0.6;
      if(planetY>H-200){
        // reached planet -> next level
        level++; lvlLbl.textContent=level; planetIn=false; planetY=-120;
        spawnWave();
      }
    }
    drawPlanet();

    // Player movement
    if(keys['ArrowLeft']) player.x -= player.speed;
    if(keys['ArrowRight']) player.x += player.speed;
    player.x = Math.max(6, Math.min(W-30, player.x));
    drawShip();

    // Shooting
    player.cd = Math.max(0, player.cd-1);
    if(keys[' '] && player.cd===0){
      bullets.push({x:player.x+11,y:player.y-6,v: -8});
      player.cd=8;
    }
    // Bullets
    ctx.fillStyle='#8ef5ff';
    bullets.forEach(b=>{ b.y += b.v; ctx.fillRect(b.x,b.y,4,8) });
    bullets = bullets.filter(b=>b.y>-20);

    // Rocks
    for(const r of rocks){
      r.x += r.vx; r.y += r.vy*(r.comet?1.6:1);
      if(r.x<-30) r.x=W+30; if(r.x>W+30) r.x=-30;
      // draw 8-bit rock
      pxRect(r.x-r.r, r.y-r.r, r.r*2, r.r*2, r.comet?'#ffe08a':'#c5ccff');
      pxRect(r.x-r.r*0.5, r.y-r.r*0.5, r.r, r.r, r.comet?'#ffc166':'#e8ecff');
    }
    // Collisions bullet->rock
    for(const b of bullets){
      for(const r of rocks){
        const dx=b.x-(r.x), dy=b.y-(r.y), d=dx*dx+dy*dy;
        if(d<(r.r*r.r)){
          r.hp--; b.y=-9999; score+=10; scoreLbl.textContent=score;
        }
      }
    }
    // Remove destroyed rocks
    rocks = rocks.filter(r=>{
      if(r.hp<=0){ score+=15; scoreLbl.textContent=score; return false }
      return r.y<H+40;
    });

    // Rock hits player
    for(const r of rocks){
      const inX = player.x < r.x+r.r && player.x+player.w > r.x-r.r;
      const inY = player.y < r.y+r.r && player.y+player.h > r.y-r.r;
      if(inX && inY){
        lives--; livesLbl.textContent=lives;
        r.y = H+100;
        if(lives<=0){
          running=false;
          state.hi.shooter = Math.max(state.hi.shooter, score);
          store.save(state); renderProfile();
          ctx.fillStyle='rgba(0,0,0,.6)'; ctx.fillRect(0,0,W,H);
          ctx.fillStyle='#fff'; ctx.font='28px monospace';
          ctx.textAlign='center';
          ctx.fillText('Game Over', W/2, H/2-10);
          ctx.fillText(`Score: ${score}`, W/2, H/2+24);
          return;
        }
      }
    }
    requestAnimationFrame(step);
  }
  startBtn.addEventListener('click', ()=>{
    resetGame(); spawnWave(); running=true; paused=false; planetX=W/2; planetY=-120; requestAnimationFrame(step);
  });
})();

/* -------------------------
   Blackjack (visual cards + currency)
--------------------------*/
(function(){
  const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
  const colors = { '‚ô†':'black','‚ô£':'black','‚ô•':'red','‚ô¶':'red' };
  const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
  let deck = [];
  let dealer=[], player=[], hidden=true;
  let bet=0;
  const msg = $('#bjMsg');
  const dealerHand = $('#dealerHand');
  const playerHand = $('#playerHand');
  const deckLeft = $('#bjDeckLeft');
  const betLbl = $('#bjBet');
  const balLbl = $('#bjBal');
  const btnDeal = $('#btnDeal'), btnHit = $('#btnHit'), btnStand = $('#btnStand'), btnDouble = $('#btnDouble'), btnNew = $('#btnNewRound');

  function buildDeck(){
    deck = [];
    for(const s of suits){
      for(const r of ranks){
        deck.push({s,r});
      }
    }
    // shuffle
    for(let i=deck.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [deck[i],deck[j]]=[deck[j],deck[i]];
    }
    deckLeft.textContent = deck.length;
  }
  function cardValue(c){
    if(c.r==='A') return 11;
    if(['K','Q','J'].includes(c.r)) return 10;
    return parseInt(c.r,10);
  }
  function handValue(arr){
    let total = arr.reduce((s,c)=>s+cardValue(c),0);
    let aces = arr.filter(c=>c.r==='A').length;
    while(total>21 && aces>0){ total-=10; aces--; }
    return total;
  }
  function renderHand(el, arr, hideFirst=false){
    el.innerHTML='';
    arr.forEach((c,i)=>{
      const cardEl = document.createElement('div');
      cardEl.className = 'card ' + (colors[c.s]==='red'?'red':'black');
      if(hideFirst && i===0){
        cardEl.className+=' back';
        el.appendChild(cardEl); return;
      }
      const top = document.createElement('div'); top.className='rank'; top.textContent=c.r;
      const suit = document.createElement('div'); suit.className='suit'; suit.textContent=c.s;
      const pips = document.createElement('div'); pips.className='pips'; pips.textContent=c.s;
      cardEl.appendChild(top); cardEl.appendChild(suit); cardEl.appendChild(pips);
      el.appendChild(cardEl);
    });
  }
  function setMsg(text, type=''){
    msg.className = 'banner'+(type?(' '+type):''); msg.textContent = text;
  }
  function resetRound(){
    dealer=[]; player=[]; hidden=true; renderHand(dealerHand, dealer, false); renderHand(playerHand, player, false);
    btnHit.disabled=btnStand.disabled=btnDouble.disabled=true; btnDeal.disabled=false; btnNew.disabled=true;
    setMsg('Place your bet to begin.');
    bet=0; betLbl.textContent='$0';
  }
  function ensureDeck(){
    if(deck.length<15) buildDeck();
    deckLeft.textContent = deck.length;
  }
  function deal(){
    if(bet<=0){ setMsg('Select a bet first.', ''); return; }
    if(state.bank<bet){ setMsg('Insufficient balance. Lower your bet.', 'lose'); return; }
    ensureDeck(); dealer=[deck.pop(), deck.pop()]; player=[deck.pop(), deck.pop()]; hidden=true;
    state.bank -= bet; store.save(state); renderProfile();
    balLbl.textContent = `$${state.bank.toLocaleString()}`;
    renderHand(dealerHand, dealer, true);
    renderHand(playerHand, player, false);
    btnHit.disabled=btnStand.disabled=btnDouble.disabled=false;
    btnDeal.disabled=true; btnNew.disabled=true;
    const pVal = handValue(player);
    if(pVal===21){ // natural blackjack
      hidden=false; renderHand(dealerHand, dealer, false);
      const dVal = handValue(dealer);
      if(dVal===21){ setMsg('Push. Blackjack vs Blackjack.',''); state.bank += bet; }
      else { const win = Math.floor(bet*1.5)+bet; state.bank+=win; setMsg('Blackjack! Paid 3:2','win'); }
      state.hi.bankroll = Math.max(state.hi.bankroll||0, state.bank);
      store.save(state); renderProfile(); btnNew.disabled=false; btnHit.disabled=btnStand.disabled=btnDouble.disabled=true;
    }else setMsg('Your move.');
  }
  function hit(){
    ensureDeck(); player.push(deck.pop()); renderHand(playerHand, player, false);
    const v=handValue(player);
    if(v>21){ hidden=false; renderHand(dealerHand, dealer, false); setMsg('Busted. Dealer wins.','lose'); btnHit.disabled=btnStand.disabled=btnDouble.disabled=true; btnNew.disabled=false; }
  }
  function stand(){
    hidden=false; renderHand(dealerHand, dealer, false);
    // dealer hits soft 16, stands on soft 17+
    while(handValue(dealer)<17){
      ensureDeck(); dealer.push(deck.pop());
    }
    const p=handValue(player), d=handValue(dealer);
    if(d>21 || p>d){ state.bank+=bet*2; setMsg('You win!','win') }
    else if(p===d){ state.bank+=bet; setMsg('Push.','') }
    else { setMsg('Dealer wins.','lose') }
    state.hi.bankroll = Math.max(state.hi.bankroll||0, state.bank);
    store.save(state); renderProfile();
    btnHit.disabled=btnStand.disabled=btnDouble.disabled=true; btnNew.disabled=false;
  }
  function dbl(){
    if(state.bank<bet){ setMsg('Not enough balance to double.','lose'); return; }
    state.bank -= bet; bet*=2; betLbl.textContent = `$${bet}`; store.save(state); renderProfile();
    hit();
    if(handValue(player)<=21){ stand(); }
  }
  // Wire up buttons
  $('.rack').addEventListener('click', (e)=>{
    const v = e.target.getAttribute('data-bet'); if(!v) return;
    bet = parseInt(v,10); betLbl.textContent = `$${bet}`; setMsg('Ready. Press Deal.');
  });
  btnDeal.addEventListener('click', deal);
  btnHit.addEventListener('click', hit);
  btnStand.addEventListener('click', stand);
  btnDouble.addEventListener('click', dbl);
  btnNew.addEventListener('click', resetRound);

  // init
  buildDeck(); resetRound();
})();

/* -------------------------
   TicTacToe (vs CPU)
--------------------------*/
(function(){
  const boardEl = $('#tttBoard');
  const status = $('#tttStatus');
  let board, turn, over;
  function draw(){
    boardEl.innerHTML='';
    board.forEach((v,i)=>{
      const btn = document.createElement('button');
      btn.style.width='120px'; btn.style.height='120px'; btn.style.fontSize='34px'; btn.style.borderRadius='12px';
      btn.style.border='1px solid rgba(255,255,255,.1)'; btn.style.background='#0b0e2b';
      btn.textContent = v || '';
      btn.addEventListener('click', ()=>move(i));
      boardEl.appendChild(btn);
    });
  }
  function reset(){ board=Array(9).fill(''); turn='X'; over=false; status.textContent='Make a move.'; draw(); }
  function win(b,p){
    const lines=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    return lines.some(l=>l.every(i=>b[i]===p));
  }
  function ai(){
    // simple: win, block, otherwise pick center/corner/random
    const me='O', you='X';
    let i = bestMove(me) ?? bestMove(you) ?? [4,0,2,6,8].find(i=>!board[i]);
    if(i==null){ const empties=board.map((v,idx)=>v?null:idx).filter(v=>v!=null); i=empties[Math.floor(Math.random()*empties.length)] }
    board[i]=me; turn='X'; draw();
    if(win(board,me)){ status.textContent='CPU wins.'; over=true }
    else if(board.every(Boolean)){ status.textContent='Draw.'; over=true }
  }
  function bestMove(p){
    const lines=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(const [a,b,c] of lines){
      const cells=[board[a],board[b],board[c]];
      if(cells.filter(v=>v===p).length===2 && cells.includes('')) return [a,b,c][cells.indexOf('')];
    }
    return null;
  }
  function move(i){
    if(over || board[i]) return;
    board[i]='X'; turn='O'; draw();
    if(win(board,'X')){ status.textContent='You win!'; over=true; state.hi.tttWins=(state.hi.tttWins||0)+1; store.save(state); renderProfile(); return }
    if(board.every(Boolean)){ status.textContent='Draw.'; over=true; return}
    setTimeout(ai, 260);
  }
  $('#tttReset').addEventListener('click', reset);
  reset();
})();

/* -------------------------
   Snake
--------------------------*/
(function(){
  const c = document.getElementById('snakeCanvas');
  const ctx = c.getContext('2d');
  const startBtn = $('#snakeStart');
  const scoreLbl = $('#snakeScore');
  const bestLbl = $('#snakeBest');
  let grid=30, vx=1, vy=0, snake, food, score, loop, speed;
  function rndCell(){ return Math.floor(Math.random()*(c.width/grid)) }
  function reset(){
    snake=[{x:5,y:9},{x:4,y:9},{x:3,y:9}]; vx=1; vy=0; score=0; speed=120;
    food={x:rndCell(), y:rndCell()};
    scoreLbl.textContent=score; bestLbl.textContent=state.hi.snake||0;
    clearInterval(loop); loop=setInterval(step, speed);
  }
  window.addEventListener('keydown', e=>{
    if(e.key==='ArrowLeft' && vx!==1){vx=-1;vy=0}
    else if(e.key==='ArrowRight' && vx!==-1){vx=1;vy=0}
    else if(e.key==='ArrowUp' && vy!==1){vx=0;vy=-1}
    else if(e.key==='ArrowDown' && vy!==-1){vx=0;vy=1}
  });
  function step(){
    // move
    const head = {x:snake[0].x+vx, y:snake[0].y+vy};
    if(head.x<0) head.x = c.width/grid-1;
    if(head.y<0) head.y = c.height/grid-1;
    head.x%=c.width/grid; head.y%=c.height/grid;
    // collide with self
    if(snake.some(s=>s.x===head.x && s.y===head.y)){ gameOver(); return; }
    snake.unshift(head);
    // eat
    if(head.x===food.x && head.y===food.y){
      score++; scoreLbl.textContent=score;
      state.hi.snake = Math.max(state.hi.snake||0, score); store.save(state); renderProfile();
      food={x:rndCell(), y:rndCell()};
      // speed up
      clearInterval(loop); speed=Math.max(60, 120 - score*3); loop=setInterval(step, speed);
      // add small bank bonus
      state.bank += 1; store.save(state); renderProfile();
    }else snake.pop();

    // draw
    ctx.clearRect(0,0,c.width,c.height);
    // starry board overlay
    ctx.fillStyle='#0a0d22'; ctx.fillRect(0,0,c.width,c.height);
    ctx.fillStyle='#8ef5ff'; ctx.fillRect(food.x*grid, food.y*grid, grid-2, grid-2);
    ctx.fillStyle='#7aa2ff';
    snake.forEach((s,i)=>ctx.fillRect(s.x*grid, s.y*grid, grid-2, grid-2));
  }
  function gameOver(){
    clearInterval(loop);
    ctx.fillStyle='rgba(0,0,0,.6)'; ctx.fillRect(0,0,c.width,c.height);
    ctx.fillStyle='#fff'; ctx.font='28px Inter, system-ui'; ctx.textAlign='center';
    ctx.fillText('Game Over', c.width/2, c.height/2-10);
    ctx.fillText(`Score: ${score}`, c.width/2, c.height/2+24);
  }
  startBtn.addEventListener('click', reset);
})();

/* -------------------------
   Memory (Meteor Match)
--------------------------*/
(function(){
  const icons = ['‚òÑÔ∏è','ü™ê','üåë','‚≠ê','üåü','üåå','üöÄ','üõ∞Ô∏è','üå†','üõ∏','üßë‚ÄçüöÄ','üî≠'];
  let deck=[], first=null, second=null, moves=0, startTime=0, timer=null, done=0;
  const grid = $('#memGrid'), movesLbl = $('#memMoves'), timeLbl = $('#memTime'), banner=$('#memBanner');
  function setup(){
    const chosen = icons.slice(0,12);
    deck = [...chosen, ...chosen].sort(()=>Math.random()-0.5).map((v,i)=>({id:i, v, open:false, matched:false}));
    grid.innerHTML=''; moves=0; timeLbl.textContent='0.0s'; done=0; first=second=null; movesLbl.textContent=0;
    startTime = performance.now(); clearInterval(timer);
    timer=setInterval(()=>{ timeLbl.textContent = ((performance.now()-startTime)/1000).toFixed(1)+'s' }, 100);
    for(const card of deck){
      const btn=document.createElement('button');
      btn.style.width='100px'; btn.style.height='120px'; btn.style.fontSize='32px'; btn.style.borderRadius='12px';
      btn.style.border='1px solid rgba(255,255,255,.1)'; btn.style.background='#0b0e2b';
      btn.textContent='‚ùî'; btn.dataset.id=card.id;
      btn.addEventListener('click', ()=>flip(card, btn));
      grid.appendChild(btn);
    }
    banner.textContent='Good luck!';
  }
  function flip(card, btn){
    if(card.open || card.matched) return;
    card.open=true; btn.textContent=card.v;
    if(!first){ first={card,btn}; return; }
    if(!second){ second={card,btn}; moves++; movesLbl.textContent=moves;
      if(first.card.v===second.card.v){
        first.card.matched=second.card.matched=true; done+=2; first=null; second=null;
        if(done===deck.length){
          clearInterval(timer);
          const secs = parseFloat(timeLbl.textContent);
          banner.textContent='All matched! üéâ';
          // set personal best
          if(!state.hi.memBest || secs<state.hi.memBest){ state.hi.memBest=secs.toFixed(1); store.save(state); renderProfile(); }
          // tiny bank bonus
          state.bank+=25; store.save(state); renderProfile();
        }
      }else{
        setTimeout(()=>{
          first.card.open=false; second.card.open=false; first.btn.textContent='‚ùî'; second.btn.textContent='‚ùî'; first=null; second=null;
        }, 600);
      }
    }
  }
  $('#memRestart').addEventListener('click', setup);
  setup();
})();

/* -------------------------
   Help modal + sound stub
--------------------------*/
(function(){
  const back = $('#helpBack');
  $('#openHelp').addEventListener('click', ()=> back.classList.add('show'));
  $('#closeHelp').addEventListener('click', ()=> back.classList.remove('show'));
  const btnSound = $('#btnSound');
  let on=true; btnSound.addEventListener('click', ()=>{ on=!on; btnSound.textContent = on?'üîä Sound On':'üîá Sound Off' });
})();
</script>
</body>
</html>

